<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Iniciar sesión</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <link rel="stylesheet" th:href="@{/css/login.css}" />
    
</head>
<body>
    <div class="login-container">
        <h2>Iniciar sesión</h2>
        <!-- <form th:action="@{/login}" method="post"> -->
        <form id="loginForm">
            <div>
                <label for="correo">Correo:</label>
                <input type="text" id="correo" name="correo" required />
            </div>
            <div>
                <label for="contrasena">Contraseña:</label>
                <input type="password" id="contrasena" name="contrasena" required />
            </div>
            <div>
                <button type="submit">Ingresar</button>
            </div>
            <!-- <div th:if="${param.error}">
                <p class="error">Usuario o contraseña incorrectos.</p>
            </div> -->
            <p id="msg"></p>
        </form>
        <a href="/inicio">Volver al inicio</a>
    </div>
</body>
</html>

<!-- <!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Iniciar sesión</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <link rel="stylesheet" th:href="@{/css/login.css}" />
</head>
<body>
<h2>Iniciar Sesión</h2>

<form id="loginForm">
    <label for="correo">Correo:</label>
    <input type="email" id="correo" name="correo" required><br><br>

    <label for="contrasena">Contraseña:</label>
    <input type="password" id="contrasena" name="contrasena" required><br><br>

    <button type="submit">Ingresar</button>
</form>

<p id="msg"></p>
-->

<script>
document.getElementById('loginForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    const correo = document.getElementById('correo').value;
    const contrasena = document.getElementById('contrasena').value;

    const response = await fetch('/api/auth/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ correo, contrasena })
    });

    const data = await response.json();

    if (response.ok) {
        // Guarda el token en localStorage
        localStorage.setItem('token', data.token);
        document.getElementById('msg').innerText = "Login exitoso, redirigiendo...";
        setTimeout(() => window.location.href = '/home', 1000);
    } else {
        document.getElementById('msg').innerText = data.error || "Error en el login";
    }
});
</script>
</body>
</html>
