<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Detalle de Maquinaria</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <link rel="stylesheet" th:href="@{/css/maquinaria_detalle.css}" />
    <style>
        .detalle-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .detalle-table th, .detalle-table td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        .detalle-table th { background: #f0f0f0; }
        .buscador { margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="main-container">
        <h2>Detalle de Maquinaria</h2>
        <input type="text" id="buscador" class="buscador" placeholder="Buscar maquinaria..." onkeyup="filtrarMaquinarias()" />
        <select id="maquinariaSelect" onchange="mostrarDetalle()">
            <option value="">Seleccione una maquinaria</option>
            <th:block th:if="${maquinarias != null}" th:each="maq : ${maquinarias}">
                <option th:value="${maq.id}" th:text="${maq.tipo + ' - ' + maq.marca + ' (' + maq.ubicacion + ')'}"></option>
            </th:block>
        </select>
        <button onclick="limpiarSeleccion()">Limpiar selecci칩n</button>
        <div id="detalleContainer" style="display:none;">
            <table class="detalle-table">
                <tr><th>Tipo</th><td id="tipo"></td></tr>
                <tr><th>Ubicaci칩n</th><td id="ubicacion"></td></tr>
                <tr><th>Fecha disponible</th><td id="fecha_disponible"></td></tr>
                <tr><th>Precio</th><td id="precio"></td></tr>
                <tr><th>Marca</th><td id="marca"></td></tr>
                <tr><th>A침o de fabricaci칩n</th><td id="anio_fabricacion"></td></tr>
                <tr><th>Capacidad</th><td id="capacidad"></td></tr>
                <tr><th>Mantenciones</th><td id="mantenciones"></td></tr>
                <tr><th>Condiciones</th><td id="condiciones"></td></tr>
                <tr><th>Medios de pago</th><td id="medios_pago"></td></tr>
            </table>
        </div>
        <a href="/home">Volver al Home</a>
    </div>
    <script th:inline="javascript">
        let maquinarias = /*[[${maquinariasJson}]]*/ [];
        if (typeof maquinarias === 'string') {
            maquinarias = JSON.parse(maquinarias);
        }
        function filtrarMaquinarias() {
            const texto = document.getElementById('buscador').value.toLowerCase();
            const select = document.getElementById('maquinariaSelect');
            for (let i = 1; i < select.options.length; i++) {
                const option = select.options[i];
                option.style.display = option.text.toLowerCase().includes(texto) ? '' : 'none';
            }
        }
        function mostrarDetalle() {
            const id = document.getElementById('maquinariaSelect').value;
            if (!id) { limpiarSeleccion(); return; }
            const maq = maquinarias.find(m => m.id == id);
            if (maq) {
                document.getElementById('tipo').textContent = maq.tipo;
                document.getElementById('ubicacion').textContent = maq.ubicacion;
                document.getElementById('fecha_disponible').textContent = maq.fecha_disponible ? new Date(maq.fecha_disponible).toLocaleDateString('es-CL') : '';
                document.getElementById('precio').textContent = maq.precio;
                document.getElementById('marca').textContent = maq.marca;
                document.getElementById('anio_fabricacion').textContent = maq.anio_fabricacion;
                document.getElementById('capacidad').textContent = maq.capacidad;
                document.getElementById('mantenciones').textContent = maq.mantenciones;
                document.getElementById('condiciones').textContent = maq.condiciones;
                document.getElementById('medios_pago').textContent = maq.medios_pago;
                document.getElementById('detalleContainer').style.display = '';
            }
        }
        function limpiarSeleccion() {
            document.getElementById('maquinariaSelect').value = '';
            document.getElementById('buscador').value = '';
            document.getElementById('detalleContainer').style.display = 'none';
            filtrarMaquinarias(); // Opcional: para mostrar todas las opciones nuevamente
        }
    </script>
</body>
</html>
